<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Kids' Balloon Pop XR</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-super-hands-component@^4.0.0/dist/super-hands.min.js"></script>
    <script>
      // Balloon pop logic + physics
      AFRAME.registerComponent('pop-balloon', {
        schema: { soundSrc: { type: 'string', default: '#pop-sound' } },
        init: function () {
          const el = this.el;
          el.addEventListener('grab-start', () => {
            el.setAttribute('animation', {
              property: 'scale',
              dur: 100,
              from: '1 1 1',
              to: '1.2 1.2 1.2',
              easing: 'easeInOutQuad'
            });
          });
          el.addEventListener('grab-end', () => {
            // Throw physics
            const impulse = new THREE.Vector3(0, 2, -3);
            el.body.applyImpulse(impulse, el.object3D.position);
          });
          el.addEventListener('collide', (e) => {
            if (e.detail.body.el.tagName === 'A-PLANE') {
              this.pop();
            }
          });
          // Pop on touch (for mobile/desktop)
          el.addEventListener('click', this.pop.bind(this));
        },
        pop: function () {
          const el = this.el;
          el.components.sound && el.components.sound.playSound();
          el.setAttribute('visible', false);
          el.setAttribute('dynamic-body', 'enabled', false);

          // âœ¨ Particle burst
          const burst = document.createElement('a-entity');
          burst.setAttribute('particle-system', {
            preset: 'dust',
            color: el.getAttribute('material').color,
            particleCount: 100,
            maxAge: 0.8
          });
          burst.setAttribute('position', el.getAttribute('position'));
          el.sceneEl.appendChild(burst);
          setTimeout(() => burst.parentNode.removeChild(burst), 1000);
        }
      });

      // Spawn balloons in a semi-circle
      AFRAME.registerComponent('balloon-spawner', {
        schema: { count: { default: 6 } },
        init: function () {
          const colors = ['#ff6b6b', '#4ecdc4', '#ffd166', '#06d6a0', '#118ab2', '#ef476f'];
          for (let i = 0; i < this.data.count; i++) {
            const angle = (i / this.data.count) * Math.PI - Math.PI / 2;
            const x = Math.cos(angle) * 2;
            const z = Math.sin(angle) * 2 + 3;

            const balloon = document.createElement('a-sphere');
            balloon.setAttribute('radius', 0.25);
            balloon.setAttribute('color', colors[i % colors.length]);
            balloon.setAttribute('position', { x: x, y: 1.2, z: z });
            balloon.setAttribute('dynamic-body', { shape: 'sphere', mass: 0.5 });
            balloon.setAttribute('pop-balloon', '');
            balloon.setAttribute('super-hands', 'colliderEvent: collide');
            balloon.setAttribute('sound', {
              src: '#pop-sound',
              positional: true,
              poolSize: 5
            });
            // Balloon string
            const string = document.createElement('a-cylinder');
            string.setAttribute('height', 0.8);
            string.setAttribute('radius', 0.005);
            string.setAttribute('color', '#555');
            string.setAttribute('position', { x: 0, y: -0.4, z: 0 });
            balloon.appendChild(string);

            this.el.appendChild(balloon);
          }
        }
      });
    </script>
  </head>
  <body>
    <!-- ðŸŽµ Pop sound (tiny base64 for demo) -->
    <audio id="pop-sound" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFeW5tY19aT0I5LRcJAPXs6OXj3tvY1dHPzMrIx8bFxL+/vby6urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLioiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEA" preload="auto"></audio>

    <a-scene 
      physics="debug: false; gravity: -9.8"
      renderer="gammaOutput: true; colorManagement: true"
      cursor="rayOrigin: mouse"
      raycaster="objects: .balloon"
    >
      <!-- ðŸŒˆ AI-generated skybox (via prompt: "whimsical cartoon sky with floating candy clouds and rainbows, ultra HD") -->
      <a-sky src="https://cdn.glitch.global/8b0c9a37-1f73-4592-8f9f-23514c8a3e78/sky-ai-generated.webp?v=1732555280512" rotation="0 -30 0"></a-sky>

      <!-- ðŸŒ³ AI-generated ground (prompt: "colorful grassy hill with flowers and mushrooms, cartoon style, soft shadows") -->
      <a-plane 
        position="0 -0.5 -5" 
        rotation="-90 0 0" 
        width="20" 
        height="20"
        src="https://cdn.glitch.global/8b0c9a37-1f73-4592-8f9f-23514c8a3e78/ground-ai-generated.webp?v=1732555280512"
        repeat="4 4"
        static-body
      ></a-plane>

      <!-- ðŸŽˆ Balloons -->
      <a-entity balloon-spawner="count: 6" position="0 0 -3"></a-entity>

      <!-- ðŸ–ï¸ Hands (Quest + desktop fallback) -->
      <a-entity id="rig" movement-controls="fly: true">
        <a-entity
          id="camera"
          camera
          position="0 1.6 0"
          look-controls
        ></a-entity>

        <!-- Left hand -->
        <a-entity
          hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcc00"
          super-hands="colliderEvent: collide"
          grabbable
          stretchable
          position="0.2 1.2 -0.5"
        ></a-entity>

        <!-- Right hand -->
        <a-entity
          hand-controls="hand: right; handModelStyle: lowPoly; color: #ff6699"
          super-hands="colliderEvent: collide"
          grabbable
          stretchable
          position="-0.2 1.2 -0.5"
        ></a-entity>
      </a-entity>

      <!-- ðŸŽ¯ Instruction UI (visible on non-VR) -->
      <a-entity
        position="0 1.8 -2"
        visible="false"
        id="ui"
      >
        <a-text
          value="ðŸŽ® Grab & throw balloons! ðŸŽˆ Pop them on the ground!"
          align="center"
          color="#ff6600"
          width="4"
        ></a-text>
        <a-text
          value="(Use mouse to drag & click on desktop)"
          align="center"
          color="#666"
          position="0 -0.2 0"
          scale="0.5 0.5 0.5"
        ></a-text>
      </a-entity>

      <a-script>
        // Show UI on non-VR
        document.addEventListener('DOMContentLoaded', () => {
          const scene = document.querySelector('a-scene');
          scene.addEventListener('enter-vr', () => {
            document.getElementById('ui').setAttribute('visible', false);
          });
          scene.addEventListener('exit-vr', () => {
            if (!AFRAME.utils.device.isMobile()) {
              document.getElementById('ui').setAttribute('visible', true);
            }
          });
          if (!AFRAME.utils.device.checkHeadsetConnected()) {
            document.getElementById('ui').setAttribute('visible', true);
          }
        });
      </a-script>
    </a-scene>
  </body>
</html>
